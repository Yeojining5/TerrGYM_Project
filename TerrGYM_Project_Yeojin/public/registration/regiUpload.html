<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.98.0">
    <title>IntelliGym 수강신규등록</title>

    <!-- ################## CSS ################## -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link rel="stylesheet" href="./index.css">

    <!-- ################## Jquery ################## -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- ###### jQuery기반의 쿠키 라이브러리 사용하기 ####### -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

    <!-- ################## fontawesome ################## -->
    <script src="https://kit.fontawesome.com/fd76fe00bf.js" crossorigin="anonymous"></script>

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

      .b-example-divider {
        height: 3rem;
        background-color: rgba(0, 0, 0, .1);
        border: solid rgba(0, 0, 0, .15);
        border-width: 1px 0;
        box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
      }

      .b-example-vr {
        flex-shrink: 0;
        width: 1.5rem;
        height: 100vh;
      }

      .bi {
        vertical-align: -.125em;
        fill: currentColor;
      }

      .nav-scroller {
        position: relative;
        z-index: 2;
        height: 2.75rem;
        overflow-y: hidden;
      }

      .nav-scroller .nav {
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        margin-top: -1px;
        overflow-x: auto;
        text-align: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }
    </style>

  </head>
  <body>

    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-storage.js"></script>
    

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCrA0QQH5QpbtWdyVbrQB72APSQxH3cjl4",
      authDomain: "semi-intelligym.firebaseapp.com",
      databaseURL: "https://semi-intelligym-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "semi-intelligym",
      storageBucket: "semi-intelligym.appspot.com",
      messagingSenderId: "925436106266",
      appId: "1:925436106266:web:5e064d6b621ccb9dfd63a3"
    };
    firebase.initializeApp(firebaseConfig);
  </script>



  <!-- ################## navbar Start ##################-->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <div class="icon p-2 me-2">
        <img class="img-fluid" src="./intell-logo2.png" alt="Icon" style="width: 30px; height: 30px;">
      </div>
      <a class="navbar-brand" href="#">IntelliGym</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
        <span class="p-0 m-3 fs-6 fw-semibold text-white" id="userName"></span>
        <a class="btn btn-outline-light mx-2" href="./login.html" role="button">Sign&nbsp;Out</a>
      </div>
    </div>
  </nav>
  <!-- ################## navbar End ##################-->

  <div class="container-fluid">
    <div class="row">
      <!-- ######################## side bar ######################################### -->
      <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
        
        <div class="position-sticky p-3 flex-shrink-0 bg-white">
          <a href="/" class="d-flex align-items-center pb-3 mb-3 link-dark text-decoration-none border-bottom">
            <svg class="bi pe-none me-2" width="30" height="24"><use xlink:href="#bootstrap"/></svg>
            <span class="fs-1 fw-semibold mt-5">Admin page</span>
          </a>
          <ul class="list-unstyled ps-0">
            <li class="mb-1">
              <button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-toggle="collapse" data-bs-target="#home-collapse" aria-expanded="false">
                나의 운동일지
              </button>
              <div class="collapse" id="home-collapse">
                <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">Overview</a></li>
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">Updates</a></li>
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">Reports</a></li>
                </ul>
              </div>
            </li>
            <li class="border-top my-3"></li>
            <li class="mb-1">
              <button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-toggle="collapse" data-bs-target="#dashboard-collapse" aria-expanded="false">
                나의 문의
              </button>
              <div class="collapse" id="dashboard-collapse">
                <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">Overview</a></li>
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">Weekly</a></li>
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">Monthly</a></li>
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">Annually</a></li>
                </ul>
              </div>
            </li>
            <li class="border-top my-3"></li>
            <li class="mb-1">
              <button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-toggle="collapse" data-bs-target="#orders-collapse" aria-expanded="true">
                수강 관리
              </button>
              <div class="collapse show" id="orders-collapse">
                <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                  <li><a href="./regiUpload.html" class="link-dark d-inline-flex text-decoration-none rounded">신규강의등록</a></li>
                  <li><a href="./regiReport.html" class="link-dark d-inline-flex text-decoration-none rounded">수강신청현황</a></li>
                </ul>
              </div>
            </li>
            <li class="border-top my-3"></li>
            <li class="mb-1">
              <button class="btn btn-toggle d-inline-flex align-items-center rounded border-0 collapsed" data-bs-toggle="collapse" data-bs-target="#account-collapse" aria-expanded="false">
                나의 정보
              </button>
              <div class="collapse" id="account-collapse">
                <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">New...</a></li>
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">Profile</a></li>
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">Settings</a></li>
                  <li><a href="#" class="link-dark d-inline-flex text-decoration-none rounded">Sign out</a></li>
                </ul>
              </div>
            </li>
            <li class="border-top my-3"></li>
          </ul>
        </div>
        
      </nav> <!-- ########################## end of side bar ######################################### -->


      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="main">
          <form>
            <div class="container w-50 p-3" >
              <h2 class="fw-bold justify-content-center">&nbsp;신규 강의 등록</h2>
              <div class="divhr" style='background:#03a9f4; height:5px; width:750px;'></div>
              
              <div class="mb-3 pt-3">
                <label class="form-label">강의분류</label>
                <input type="text" class="form-control" id="c_num">
                <div class="form-text">필라테스 | 요가 | 줌바 | 스피닝</div>
              </div>
              <div class="mb-3">
                <label class="form-label">강의번호</label>
                <input type="text" class="form-control" id="c_num">
              </div>
              <div class="mb-3">
                <label class="form-label">강의명</label>
                <input type="text" class="form-control" id="c_name">
              </div>
              <div class="mb-3">
                <label class="form-label">강사명</label>
                <input type="text" class="form-control" id="c_teacher">
              </div>
              <div class="mb-3">
                <label class="form-label">강의시간</label>
                <input type="text" class="form-control" id="c_time">
              </div>
              <div class="mb-3">
                <label class="form-label">신청인원</label>
                <input type="text" class="form-control" id="apply">
              </div>
              <div class="mb-3">
                <label class="form-label">제한인원</label>
                <input type="text" class="form-control" id="limit">
              </div>
              <div class="mb-3">
                <label class="form-label">이미지</label>
                <input class="form-control" type="file" id="image">
              </div>
              <div class="d-grid gap-2 col-6 mx-auto mt-4">
                <button id="send" class="btn btn-primary btn-lg" type="button">
                  수강등록
                </button>
              </div>
          </form>
          

        </div> <!-- end of div.container -->
      </main>
    </div> <!-- end of div.row -->
  </div> <!-- end of div.container -->

    

    

  <script>

    const db = firebase.firestore();
    const storage = firebase.storage(); // 이미지 파일을 위한 storage
    
    // 이미지는 Storage에 저장 후 저장된 위치(URL)를 Database에 저장
    // Storage에 파일 저장하기
    $('#send').click(function(){

      const file = document.querySelector('#image').files[0]; // 업로드한 파일의 첫번째 파일을 찾아줌 
      const storageRef = storage.ref(); // 저장경로 정하는 부분 
      const imgPath = storageRef.child('image/' + file); 
      const upload = imgPath.put(file) // 위에서 선언한 file을 넣어준다

      // 이미지 업로드 성공/실패 시 코드 실행
      upload.on( 'state_changed', 
        // 변화시 동작하는 함수 
        null, 
        //에러시 동작하는 함수
        (error) => {
          console.error('실패사유는', error);
        }, 
        // 성공시 동작하는 함수
        () => {
          // url구하는 함수문 - 그냥 문법
          upload.snapshot.ref.getDownloadURL().then((url) => {
            console.log('url', url);

            const gangnam_class = { 
              강의번호 : parseInt($('#c_num').val()), // .val() 입력한값
              강의명 : $('#c_name').val(),
              강사명 : $('#c_teacher').val(),
              강의시간 : $('#c_time').val(),
              신청인원 : $('#apply').val(),
              제한인원 : $('#limit').val(),
              이미지 : url
            }

            // yes, no 확인창
            if(gangnam_class) {
                if(confirm("강의를 등록하시겠습니까?")) {
                    // yes
                    // then은 성공했을 때, catch는 실패했을 때
                    db.collection('center_gangnam').add(gangnam_class).then((result)=>{
                      console.log(result);
                      /* window.location.href = "/index.html"; */
                    }).catch((err)=>{
                      console.log(err);
                    })
                } else {
                    // no
                    console.log("cancelled");
                }
              }
              else {
                alert("내용을 입력해 주세요.");
              }
          });
        }
    );

      
    });
  </script>  
  


    <!-- ################## JavaScript ################## -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
    <script src="./index.js"></script>
</body>
</html>